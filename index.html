<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Grageas MÃ¡gicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;600&family=Luckiest+Guy&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2.decorated-title, h3 {
            font-family: 'Cinzel', serif;
        }
        .font-luckiest {
            font-family: 'Luckiest Guy', cursive;
        }
        /* Estilo para la barra de desplazamiento */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        .tab-btn.active {
            border-color: #f59e0b; /* yellow-500 */
            color: #f59e0b;
            background-color: #374151; /* gray-700 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Columna de ConfiguraciÃ³n y Referencia -->
        <div class="lg:col-span-1 flex flex-col gap-8">
            <!-- SecciÃ³n de ConfiguraciÃ³n -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
                <h1 class="text-3xl font-bold text-yellow-400 mb-6 text-center">ConfiguraciÃ³n</h1>

                <div class="space-y-4">
                    <div>
                        <label for="cantidadGrageas" class="block mb-2 text-sm font-medium text-gray-300">NÃºmero de Grageas (MÃ¡x. 5):</label>
                        <input type="number" id="cantidadGrageas" value="1" min="1" max="5" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-yellow-500 focus:border-yellow-500 block w-full p-2.5">
                    </div>

                    <div id="grageasContainer" class="space-y-6">
                        <!-- Los selectores de grageas se insertarÃ¡n aquÃ­ -->
                    </div>

                    <button id="abrirBtn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-md">
                        âœ¨ Abrir Grageas
                    </button>
                </div>
            </div>

            <!-- SecciÃ³n de Sabores Disponibles -->
            <div class="bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-700">
                <h2 class="text-2xl font-bold text-yellow-400 mb-4 text-center decorated-title">Sabores Disponibles</h2>
                <div id="saboresList" class="max-h-80 overflow-y-auto pr-2 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                    <!-- La lista de sabores se insertarÃ¡ aquÃ­ -->
                </div>
            </div>
        </div>

        <!-- Columna de Resultados -->
        <div class="lg:col-span-2">
            <div class="bg-black p-6 rounded-2xl shadow-lg border border-gray-700 h-full flex flex-col min-h-[80vh] lg:min-h-0">
                <!-- PestaÃ±as para cambiar de vista -->
                <div class="flex border-b border-gray-700 mb-4">
                    <button id="tabDecorado" class="tab-btn active py-2 px-4 border-b-2 font-medium transition-colors duration-300">Decorado</button>
                    <button id="tabSimple" class="tab-btn py-2 px-4 border-b-2 border-transparent font-medium text-gray-400 hover:text-yellow-400 transition-colors duration-300">Simple</button>
                </div>

                <!-- Contenedor de Resultados Decorados (visible por defecto) -->
                <div id="panelDecorado" class="flex flex-col flex-grow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-yellow-400 decorated-title">Resultados</h2>
                        <button id="copiarBtnDecorado" class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                            Copiar Decorado
                        </button>
                    </div>
                    <div class="relative flex-grow">
                        <textarea id="resultadoTextoDecorado" readonly class="w-full h-full bg-black text-white font-mono p-4 rounded-md border border-gray-600 resize-none focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                    </div>
                </div>

                <!-- Contenedor de Resultados Simples (oculto por defecto) -->
                <div id="panelSimple" class="hidden flex-col flex-grow">
                     <div class="flex justify-end items-center mb-4">
                         <button id="copiarBtnSimple" class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-medium py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
                             Copiar Simple
                         </button>
                     </div>
                    <div id="resultadoTextoSimpleContainer" class="w-full h-full bg-black text-white p-4 rounded-md border border-gray-600 overflow-y-auto">
                        <h2 id="simpleTitle" class="text-4xl text-white font-luckiest tracking-wider mb-6"></h2>
                        <div id="resultadoTextoSimple" style="white-space: pre-wrap; font-family: 'Inter', sans-serif; font-size: 1.1rem; line-height: 2;"></div>
                    </div>
                </div>

                <!-- Mensaje de Copiado -->
                <div id="copiadoMsg" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-green-500 text-white px-6 py-3 rounded-lg text-lg opacity-0 transition-opacity duration-500 pointer-events-none">
                    Â¡Texto Copiado!
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- DATOS DE SABORES ---
            const sabores = [
              { "tipo": "ExplosiÃ³n de Fresa", "emoji": "ğŸ“" },
              { "tipo": "Mango MaracuyÃ¡ Boom", "emoji": "ğŸ¥­" },
              { "tipo": "PiÃ±a Colada Chill", "emoji": "ğŸğŸ¥¥" },
              { "tipo": "Uva CÃ³smica", "emoji": "ğŸ‡" },
              { "tipo": "SandÃ­a Fresh Mint", "emoji": "ğŸ‰ğŸŒ¿" },
              { "tipo": "Durazno CÃ­trico", "emoji": "ğŸ‘ğŸ‹" },
              { "tipo": "Cereza Intensa", "emoji": "ğŸ’" },
              { "tipo": "Blueberry Limonada", "emoji": "ğŸ«ğŸ‹" },
              { "tipo": "MelÃ³n Sakura", "emoji": "ğŸˆğŸŒ¸" },
              { "tipo": "Manzana Verde con Menta", "emoji": "ğŸğŸƒ" },
              { "tipo": "Choco-Avellana Supreme", "emoji": "ğŸ«ğŸŒ°" },
              { "tipo": "Galleta con Leche", "emoji": "ğŸªğŸ¥›" },
              { "tipo": "Vainilla Miel Dorada", "emoji": "ğŸ¦ğŸ¯" },
              { "tipo": "Moka Espresso", "emoji": "â˜•ğŸ«" },
              { "tipo": "Fresa Cheesecake", "emoji": "ğŸ§ğŸ“" },
              { "tipo": "Caramelo Salado", "emoji": "ğŸ®ğŸ¥„" },
              { "tipo": "Brownie de Nuez", "emoji": "ğŸ«ğŸ¥œ" },
              { "tipo": "Donita Glaseada", "emoji": "ğŸ©âœ¨" },
              { "tipo": "Churro con Cajeta", "emoji": "ğŸ«ğŸ”¥" },
              { "tipo": "Tarta de LimÃ³n Cremosa", "emoji": "ğŸ‹ğŸ°" },
              { "tipo": "Tamarindo Enchilado", "emoji": "ğŸŒ¶ï¸ğŸ¬" },
              { "tipo": "Pepino con LimÃ³n Ice", "emoji": "ğŸ¥’ğŸ‹" },
              { "tipo": "Lavanda con Miel", "emoji": "ğŸŒ¸ğŸ¯" },
              { "tipo": "Matcha Tropical", "emoji": "ğŸµğŸ¥­" },
              { "tipo": "MaracuyÃ¡ con Jengibre", "emoji": "ğŸ«šğŸ¥­" },
              { "tipo": "Rosa con Lichis", "emoji": "ğŸŒ¹ğŸ’" },
              { "tipo": "Uva con Sal de Jamaica", "emoji": "ğŸ‡ğŸ§‚" },
              { "tipo": "PlÃ¡tano con Canela", "emoji": "ğŸŒğŸŒ°" },
              { "tipo": "Cereza Negra & Pimienta Rosa", "emoji": "ï¿½ğŸŒ¶ï¸" },
              { "tipo": "Hibisco con Granada", "emoji": "ğŸŒºğŸ·" },
              { "tipo": "Cerveza de Mantequilla Espumosa", "emoji": "ğŸº" },
              { "tipo": "Pastel de Calabaza MÃ¡gico", "emoji": "ğŸ§ˆ" },
              { "tipo": "Anti-Dementor (Chocolate Oscuro Protector)", "emoji": "ğŸ«" },
              { "tipo": "ExplosiÃ³n de Grageas Bertie Bott", "emoji": "ğŸ¬" },
              { "tipo": "Manzana de Encantamiento", "emoji": "ğŸâœ¨" },
              { "tipo": "Elixir de Fresa Encantada", "emoji": "ğŸª„ğŸ“" },
              { "tipo": "Felix Felicis (Suerte LÃ­quida de PiÃ±a)", "emoji": "ğŸ§ªğŸ" },
              { "tipo": "PociÃ³n de Uvas Nocturnas", "emoji": "ğŸ‡ğŸŒ™" },
              { "tipo": "Miel de Hipogrifo", "emoji": "ğŸ¦‰ğŸ¯" },
              { "tipo": "Fuego de Cereza FÃ©nix", "emoji": "ğŸ’ğŸ”¥" },
              { "tipo": "Encanto de Coco y Flor de Luna", "emoji": "ğŸ¥¥ğŸŒ¸" },
              { "tipo": "Tarta de Nuez del Sombrero Seleccionador", "emoji": "ğŸŒ°ğŸ§™" },
              { "tipo": "PociÃ³n PÃ©talo de Amor (Amortentia)", "emoji": "ğŸ“ğŸ‹" },
              { "tipo": "Choco-Sapo SaltarÃ­n", "emoji": "ğŸ«ğŸ§" },
              { "tipo": "Zumo de Calabaza Burbujeante", "emoji": "ğŸ§ƒğŸ«§" },
              { "tipo": "VÃ³mito", "emoji": "ğŸ¤®" },
              { "tipo": "Huevo podrido", "emoji": "ğŸ¥šğŸª°" },
              { "tipo": "Cera de oÃ­do", "emoji": "ğŸ‘‚ğŸ»" },
              { "tipo": "Moco", "emoji": "ğŸ¤§" },
              { "tipo": "Pasto", "emoji": "ğŸŒ¿" },
              { "tipo": "Tierra", "emoji": "ğŸŸ¤" },
              { "tipo": "Gusano", "emoji": "ğŸ›" },
              { "tipo": "JabÃ³n", "emoji": "ğŸ«§" },
              { "tipo": "Pimienta negra", "emoji": "â™ ï¸" },
              { "tipo": "Salchicha", "emoji": "ğŸŒ­" },
              { "tipo": "Mugre de uÃ±as", "emoji": "ğŸ’…ğŸ»" },
              { "tipo": "Caspa de Troll", "emoji": "ğŸ§Œ" },
              { "tipo": "Sudor", "emoji": "ğŸ’¦" },
              { "tipo": "Axila", "emoji": "ğŸ¦¨" },
              { "tipo": "Aceitunas", "emoji": "ğŸ«’" },
              { "tipo": "Ajo crudo", "emoji": "ğŸ§„" },
              { "tipo": "Alga marina", "emoji": "ğŸª¸" },
              { "tipo": "Aliento de dragÃ³n", "emoji": "ğŸ‰ğŸŒ¬ï¸" },
              { "tipo": "Aliento de ogro", "emoji": "ğŸ§Œ" },
              { "tipo": "AlgodÃ³n de azÃºcar", "emoji": "ğŸ­" },
              { "tipo": "ArÃ¡ndanos", "emoji": "ğŸ«" },
              { "tipo": "Baba de caracol", "emoji": "ğŸŒ" },
              { "tipo": "Bellini", "emoji": "ğŸ¥‚" },
              { "tipo": "BiberÃ³n", "emoji": "ğŸ¼" },
              { "tipo": "Blody Mary", "emoji": "ğŸ«—ğŸ©¸" },
              { "tipo": "Burrito", "emoji": "ğŸŒ¯" },
              { "tipo": "Cacahuate", "emoji": "ğŸ¥œ" },
              { "tipo": "CaÃ±a de azÃºcar", "emoji": "ğŸ‹" },
              { "tipo": "Canela en polvo", "emoji": "ğŸ‚" }
            ];

            // --- INICIO: NUEVO SISTEMA DE PREMIOS POR RAREZA ---

            // 1. Definimos las listas de premios por categorÃ­a
            const premios = {
              "Trastos": [
                { "nombre": "ğŸª™ -5.000 Galeones", "valor": -5000 },
                { "nombre": "ğŸª™ -3.000 Galeones", "valor": -3000 },
                { "nombre": "ğŸª™ -2.000 Galeones", "valor": -2000 },
                { "nombre": "ğŸª™ -1.500 Galeones", "valor": -1500 },
                { "nombre": "ğŸª™ -1.000 Galeones", "valor": -1000 },
                { "nombre": "ğŸª™ -900 Galeones", "valor": -900 },
                { "nombre": "ğŸª™ -800 Galeones", "valor": -800 },
                { "nombre": "ğŸª™ -700 Galeones", "valor": -700 },
                { "nombre": "ğŸª™ -500 Galeones", "valor": -500 },
                { "nombre": "ğŸª™ Debes donarle 5.000 Galeones a alguien", "valor": -5000 },
                { "nombre": "ğŸª™ +500 Galeones", "valor": 500 },
                { "nombre": "ğŸª™ +600 Galeones", "valor": 600 },
                { "nombre": "ğŸª™ +700 Galeones", "valor": 700 },
                { "nombre": "ğŸª™ +800 Galeones", "valor": 800 },
                { "nombre": "ğŸª™ +1.000 Galeones", "valor": 1000 }
              ],
              "Coleccionables": [
                { "nombre": "Ranita Lila ğŸ«ğŸ’œ", "valor": 1000 },
                { "nombre": "Ranita Azul ğŸ«ğŸ’™", "valor": 1000 },
                { "nombre": "Ranita Celeste ğŸ«ğŸ©µ", "valor": 1500 },
                { "nombre": "Ranita Turquesa ğŸ«ğŸŸ¢", "valor": 2000 },
                { "nombre": "Ranita Verde ğŸ«ğŸ’š", "valor": 1500 },
                { "nombre": "Ranita Amarilla ğŸ«ğŸ’›", "valor": 800 },
                { "nombre": "Ranita Dorada ğŸ«ğŸŸ ", "valor": 1200 },
                { "nombre": "Ranita Naranja ğŸ«ğŸ§¡", "valor": 900 },
                { "nombre": "Ranita Roja ğŸ«â¤ï¸", "valor": 1000 },
                { "nombre": "Ranita Rosa ğŸ«ğŸ©·", "valor": 700 },
                { "nombre": "Ranita Fucsia ğŸ«ğŸŸ£", "valor": 900 },
                { "nombre": "Ranita Negra ğŸ«ğŸ–¤", "valor": 1500 },
                { "nombre": "Mapa del Merodeador ğŸ—ºï¸ğŸ‘£", "valor": 1500 },
                { "nombre": "Collar de Slytherin ğŸ“¿ğŸ", "valor": 1600 },
                { "nombre": "Giratiempos â³ğŸ”", "valor": 2000 },
                { "nombre": "Escoba voladora ğŸ§¹ğŸª½", "valor": 2500 },
                { "nombre": "Horcruxes en general ğŸ–¤âš ï¸", "valor": 2700 },
                { "nombre": "Varita mÃ¡gica ğŸª„", "valor": 3000 }
              ],
              "Tesoros": [
                { "nombre": "ğŸª™ +1.500 Galeones", "valor": 1500 },
                { "nombre": "ğŸª™ +2.000 Galeones", "valor": 2000 },
                { "nombre": "ğŸª™ +3.000 Galeones", "valor": 3000 },
                { "nombre": "ğŸª™ +5.000 Galeones", "valor": 5000 },
                { "nombre": "ğŸª™ +7.000 Galeones", "valor": 7000 },
                { "nombre": "ğŸª™ +8.000 Galeones", "valor": 8000 },
                { "nombre": "Anillo de Sorvolo Gaunt ğŸ’â˜ ï¸", "valor": 3000 },
                { "nombre": "Piedra Filosofal ğŸ’ğŸŸ¥", "valor": 3500 },
                { "nombre": "Varita de SaÃºco ğŸŒ¿ğŸª„", "valor": 3500 },
                { "nombre": "Snitch dorada ğŸŸ¡âœ¨", "valor": 4000 },
                { "nombre": "Piedra de la ResurrecciÃ³n âš«ğŸ‘»", "valor": 4000 },
                { "nombre": "Diario de Tom Riddle ğŸ““ğŸ–¤", "valor": 4500 },
                { "nombre": "Pluma autoentintable ğŸª¶", "valor": 4600 },
                { "nombre": "Sombrero Seleccionador ğŸ©ğŸ§ ", "valor": 5000 },
                { "nombre": "Libro de Pociones del PrÃ­ncipe Mestizo ğŸ“–âš—ï¸", "valor": 5000 },
                { "nombre": "Lazo del Diablo ğŸŒ¿ğŸ•¸ï¸", "valor": 5500 },
                { "nombre": "CÃ¡liz de fuego ğŸ”¥ğŸ†", "valor": 6000 },
                { "nombre": "Reloj de los Weasley ğŸ•°ï¸ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "valor": 6000 }
              ],
              "Reliquias": [
                { "nombre": "ğŸª™ +10.000 Galeones", "valor": 10000 },
                { "nombre": "Puedes robarle 10.000 Galeones a alguien del caldero ğŸª™", "valor": 10000 },
                { "nombre": "Diadema de Ravenclaw ğŸ‘‘ğŸ§ ", "valor": 6500 },
                { "nombre": "Copa de Hufflepuff ğŸ†ğŸ§¡", "valor": 7000 },
                { "nombre": "Deluminador ğŸ’¡ğŸ•³ï¸", "valor": 7500 },
                { "nombre": "Bola de Cristal ğŸ”®", "valor": 8000 },
                { "nombre": "Espada de Godric Gryffindor âš”ï¸ğŸ¦", "valor": 9000 },
                { "nombre": "Espejo de Oesed ğŸªğŸ’­", "valor": 10000 },
                { "nombre": "Bolsa sin fondo de Hermione ğŸ‘œğŸ“¦", "valor": 10000 },
                { "nombre": "ğŸª™ -10.000 Galeones", "valor": -10000 },
                { "nombre": "ğŸª™ -7.000 Galeones", "valor": -7000 },
                { "nombre": "ğŸª™ Debes donar 10.000 Galeones a alguien del caldero", "valor": -10000 },
                { "nombre": "Capa de invisibilidad ğŸ§¥âœ¨", "valor": 20000 }
                  
              ]
            };
            
            // 2. Definimos las probabilidades de cada categorÃ­a
            const probabilidades = {
                Trastos: 0.45,       // 45% de probabilidad
                Coleccionables: 0.35, // 35% de probabilidad
                Tesoros: 0.15,        // 15% de probabilidad
                Reliquias: 0.05       // 5% de probabilidad
            };

            // 3. FunciÃ³n para elegir un efecto basado en el nuevo sistema
            const elegirEfectoAleatorio = () => {
                const aleatorio = Math.random();
                let acumulado = 0;

                for (const categoria in probabilidades) {
                    acumulado += probabilidades[categoria];
                    if (aleatorio < acumulado) {
                        const listaPremios = premios[categoria];
                        const indiceAleatorio = Math.floor(Math.random() * listaPremios.length);
                        // Devolvemos el nombre del premio, no el objeto completo
                        return listaPremios[indiceAleatorio].nombre;
                    }
                }
                // Como fallback, si algo sale mal, devuelve un Trasto
                const listaFallback = premios.Trastos;
                // Devolvemos el nombre del premio, no el objeto completo
                return listaFallback[Math.floor(Math.random() * listaFallback.length)].nombre;
            };

            // --- FIN: NUEVO SISTEMA DE PREMIOS ---


            // --- ELEMENTOS DEL DOM ---
            const cantidadGrageasInput = document.getElementById('cantidadGrageas');
            const grageasContainer = document.getElementById('grageasContainer');
            const abrirBtn = document.getElementById('abrirBtn');
            const resultadoTextoDecorado = document.getElementById('resultadoTextoDecorado');
            const resultadoTextoSimple = document.getElementById('resultadoTextoSimple');
            const simpleTitle = document.getElementById('simpleTitle');
            const copiarBtnDecorado = document.getElementById('copiarBtnDecorado');
            const copiarBtnSimple = document.getElementById('copiarBtnSimple');
            const saboresList = document.getElementById('saboresList');
            const copiadoMsg = document.getElementById('copiadoMsg');
            const tabDecorado = document.getElementById('tabDecorado');
            const tabSimple = document.getElementById('tabSimple');
            const panelDecorado = document.getElementById('panelDecorado');
            const panelSimple = document.getElementById('panelSimple');

            // --- FUNCIONES ---

            const generarSelectores = (cantidad) => {
                grageasContainer.innerHTML = '';
                for (let i = 1; i <= cantidad; i++) {
                    const grageaDiv = document.createElement('div');
                    grageaDiv.className = 'bg-gray-700 p-4 rounded-lg border border-gray-600';
                    grageaDiv.innerHTML = `<h3 class="text-lg font-semibold text-yellow-300 mb-3">Gragea ${i}</h3>`;

                    const selectorContainer = document.createElement('div');
                    selectorContainer.className = 'space-y-2';

                    for (let j = 1; j <= 3; j++) {
                        const select = document.createElement('select');
                        select.className = 'sabor-select w-full bg-gray-600 border border-gray-500 text-white text-sm rounded-lg focus:ring-yellow-500 focus:border-yellow-500 p-2';
                        sabores.forEach(sabor => {
                            const option = document.createElement('option');
                            option.value = sabor.emoji;
                            option.dataset.tipo = sabor.tipo;
                            option.textContent = `${sabor.emoji} ${sabor.tipo}`;
                            select.appendChild(option);
                        });
                        selectorContainer.appendChild(select);
                    }
                    grageaDiv.appendChild(selectorContainer);
                    grageasContainer.appendChild(grageaDiv);
                }
            };

            const poblarListaSabores = () => {
                saboresList.innerHTML = '';
                sabores.sort((a, b) => a.tipo.localeCompare(b.tipo)).forEach(sabor => {
                    const div = document.createElement('div');
                    div.className = 'bg-gray-700 p-2 rounded-md';
                    div.textContent = `${sabor.emoji} ${sabor.tipo}`;
                    saboresList.appendChild(div);
                });
            };

            const abrirGrageas = () => {
                let resultadoDecorado = 'âœ¶â•â•â•â•â•â•â•â‰ªâ€¢â—¦ â¦ â—¦â€¢â‰«â•â•â•â•â•â•â•âœ¶\n\n';
                resultadoDecorado += 'â•°â”ˆâ¤ğŸ· ğ’¢ğ“‡ğ’¶ğ‘”ğ‘’ğ’¶ ğ’¹ğ‘’ ğ“‰ğ‘œğ’¹ğ‘œğ“ˆ ğ“ğ‘œğ“ˆ ğ“ˆğ’¶ğ’·ğ‘œğ“‡ğ‘’ğ“ˆ ğŸ·\n\n';

                let resultadoSimple = '';
                let simpleCounter = 1;

                const grageas = grageasContainer.children;
                for (let i = 0; i < grageas.length; i++) {
                    resultadoDecorado += `${i + 1}.\n`;

                    const selects = grageas[i].querySelectorAll('.sabor-select');
                    selects.forEach(select => {
                        const emoji = select.value;
                        const tipo = select.options[select.selectedIndex].dataset.tipo;
                        
                        // Usamos la nueva funciÃ³n para obtener un efecto del sistema de rareza
                        const efectoAleatorio = elegirEfectoAleatorio();

                        resultadoDecorado += `${emoji}â†’ ${efectoAleatorio}\n`;
                        resultadoSimple += `${simpleCounter}. ${tipo}: ${efectoAleatorio}\n`;
                        simpleCounter++;
                    });
                    resultadoDecorado += '\n';
                }

                resultadoDecorado += 'âœ¶â•â•â•â•â•â•â•â‰ªâ€¢â—¦ â¦ â—¦â€¢â‰«â•â•â•â•â•â•â•âœ¶';

                resultadoTextoDecorado.value = resultadoDecorado.trim();
                
                simpleTitle.textContent = 'RESULTADOS';
                resultadoTextoSimple.innerText = resultadoSimple.trim();
            };

            const copiarResultado = (viewType) => {
                let textToCopy = '';
                if (viewType === 'decorado') {
                    textToCopy = document.getElementById('resultadoTextoDecorado').value;
                } else if (viewType === 'simple') {
                    const title = simpleTitle.textContent;
                    const content = resultadoTextoSimple.innerText;
                    textToCopy = `${title}\n\n${content}`;
                }

                if (!textToCopy) return;

                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();

                try {
                    document.execCommand('copy');
                    copiadoMsg.classList.remove('opacity-0');
                    setTimeout(() => {
                        copiadoMsg.classList.add('opacity-0');
                    }, 1500);
                } catch (err) {
                    console.error('Error al intentar copiar: ', err);
                }

                document.body.removeChild(tempTextArea);
                window.getSelection().removeAllRanges();
            };

            const cambiarPestaÃ±a = (tabActiva) => {
                if (tabActiva === 'decorado') {
                    panelDecorado.classList.remove('hidden');
                    panelDecorado.classList.add('flex');
                    panelSimple.classList.add('hidden');
                    panelSimple.classList.remove('flex');

                    tabDecorado.classList.add('active');
                    tabSimple.classList.remove('active');
                } else {
                    panelSimple.classList.remove('hidden');
                    panelSimple.classList.add('flex');
                    panelDecorado.classList.add('hidden');
                    panelDecorado.classList.remove('flex');

                    tabSimple.classList.add('active');
                    tabDecorado.classList.remove('active');
                }
            };

            // --- EVENT LISTENERS ---

            cantidadGrageasInput.addEventListener('change', (e) => {
                let val = parseInt(e.target.value, 10);
                if (isNaN(val) || val < 1) val = 1;
                if (val > 5) val = 5;
                e.target.value = val;
                generarSelectores(val);
            });

            abrirBtn.addEventListener('click', abrirGrageas);
            copiarBtnDecorado.addEventListener('click', () => copiarResultado('decorado'));
            copiarBtnSimple.addEventListener('click', () => copiarResultado('simple'));

            tabDecorado.addEventListener('click', () => cambiarPestaÃ±a('decorado'));
            tabSimple.addEventListener('click', () => cambiarPestaÃ±a('simple'));

            // --- INICIALIZACIÃ“N ---
            poblarListaSabores();
            generarSelectores(parseInt(cantidadGrageasInput.value, 10));
            cambiarPestaÃ±a('decorado');
        });
    </script>
</body>
</html>
